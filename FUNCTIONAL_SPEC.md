# 機能仕様書

## 概要
Talk with AI の各機能の詳細な動作仕様を定義します。

## 1. ユーザー認証・プロフィール管理

### 1.1 ユーザー登録
**機能概要**: 新規ユーザーがアカウントを作成する

**入力項目**:
- 名前（必須）: 1-20文字
- メールアドレス（必須）: 有効なメール形式
- パスワード（必須）: 8文字以上、英数字記号含む
- プログラミング経験年数（必須）: 0-20年
- 主要な専門分野（必須）: フロントエンド/バックエンド/フルスタック/モバイル/その他

**処理フロー**:
1. 入力値バリデーション
2. メールアドレス重複チェック
3. パスワードハッシュ化
4. DynamoDBにユーザー情報保存
5. 確認メール送信
6. 初回プロフィール設定画面へ遷移

**エラーハンドリング**:
- メールアドレス重複: "このメールアドレスは既に使用されています"
- パスワード不備: "パスワードは8文字以上で英数字記号を含めてください"
- ネットワークエラー: "接続エラーが発生しました。再度お試しください"

### 1.2 ログイン
**機能概要**: 既存ユーザーがログインする

**入力項目**:
- メールアドレス（必須）
- パスワード（必須）

**処理フロー**:
1. 認証情報検証
2. JWTトークン生成
3. ユーザー情報取得
4. ローカルストレージに保存
5. メイン画面へ遷移

**追加機能**:
- 「ログイン状態を保持」オプション
- パスワードリセット機能
- ソーシャルログイン（将来機能）

### 1.3 プロフィール管理
**編集可能項目**:
- 表示名
- 専門分野
- 経験年数
- 学習目標
- 通知設定

## 2. AIチャット機能

### 2.1 セッション管理
**機能概要**: 30分の学習セッションを管理する

**セッション開始処理**:
1. 前回の学習履歴を取得
2. 今日の学習目標を設定
3. AIキャラクター初期化
4. タイマー開始（30分）
5. 開始挨拶メッセージ表示

**セッション中の処理**:
- メッセージ送受信
- リアルタイム応答
- 理解度チェック
- 時間管理
- 学習進捗記録

**セッション終了処理**:
1. 学習内容のまとめ生成
2. 理解度評価
3. 次回の学習提案
4. 履歴データ保存
5. 終了メッセージ表示

### 2.2 メッセージ送受信
**入力方式**:
- テキスト入力（必須）
- 音声入力（オプション）
- コードスニペット入力

**メッセージ形式**:
```typescript
interface Message {
  id: string;
  sessionId: string;
  type: 'user' | 'ai';
  content: string;
  timestamp: Date;
  metadata?: {
    confidence?: number;
    topic?: string;
    codeSnippet?: boolean;
  };
}
```

**AI応答生成**:
1. ユーザーメッセージ解析
2. コンテキスト（過去の会話）取得
3. プロンプト生成（キャラクター設定含む）
4. AI API呼び出し
5. 応答ストリーミング表示
6. 応答内容の保存

### 2.3 音声機能
**音声入力**:
- Web Speech API使用
- 日本語音声認識
- ノイズキャンセリング
- 音声→テキスト変換

**音声出力**:
- Text-to-Speech API使用
- 自然な日本語音声
- 読み上げ速度調整
- 音声ON/OFF切り替え

**処理フロー**:
1. 音声入力開始
2. リアルタイム音声認識
3. 認識結果の表示・確認
4. メッセージ送信
5. AI応答の音声出力

## 3. 学習管理機能

### 3.1 学習履歴管理
**記録データ**:
```typescript
interface LearningSession {
  id: string;
  userId: string;
  startTime: Date;
  endTime: Date;
  duration: number; // 分
  topics: string[];
  messagesCount: number;
  comprehensionScore: number; // 0-100
  satisfactionScore?: number; // 1-5
}

interface LearningProgress {
  userId: string;
  topic: string;
  level: number; // 1-10
  lastStudied: Date;
  totalTime: number; // 分
  sessionCount: number;
  masteryScore: number; // 0-100
}
```

**履歴表示機能**:
- 日別学習時間グラフ
- 週別/月別統計
- トピック別理解度
- 学習継続日数

### 3.2 理解度評価
**評価方式**:
- 質問への回答速度
- 回答の正確性
- 追加質問の必要性
- ユーザーの反応

**評価アルゴリズム**:
```typescript
function calculateComprehension(
  responseTime: number,
  accuracy: number,
  engagement: number
): number {
  const timeScore = Math.max(0, 100 - (responseTime / 1000) * 2);
  const accuracyScore = accuracy * 100;
  const engagementScore = engagement * 100;
  
  return (timeScore * 0.3 + accuracyScore * 0.5 + engagementScore * 0.2);
}
```

### 3.3 復習システム
**復習タイミング**:
- エビングハウスの忘却曲線に基づく
- 理解度に応じた間隔調整
- 1日後、3日後、1週間後、2週間後、1ヶ月後

**復習コンテンツ**:
- 過去の重要なポイント
- 理解度が低かった内容
- 関連する新しい情報
- 実践的な課題

## 4. コンテンツ管理機能

### 4.1 学習コンテンツ配信
**コンテンツ種類**:
- 技術解説（React, TypeScript, Next.js等）
- 最新技術動向
- ベストプラクティス
- 実践的なコード例
- 問題解決のパターン

**個人最適化**:
- ユーザーの理解度に応じた難易度調整
- 専門分野に特化したコンテンツ
- 学習進捗に基づく内容選択
- 興味・関心に基づく推薦

### 4.2 進捗管理
**進捗指標**:
- 学習時間（日別/週別/月別）
- 理解度スコア
- 完了したトピック数
- 継続学習日数

**目標設定機能**:
- 日次学習時間目標
- 週次学習回数目標
- 月次習得トピック目標
- 年次スキルアップ目標

## 5. 通知・リマインダー機能

### 5.1 学習リマインダー
**通知タイミング**:
- 設定した学習時間の10分前
- 学習が途切れて2日経過時
- 週末の学習まとめ
- 月次の進捗レポート

**通知方式**:
- PWAプッシュ通知
- ブラウザ通知
- メール通知（オプション）

### 5.2 モチベーション維持
**機能**:
- 学習達成バッジ
- 連続学習記録
- 週次・月次ランキング（匿名）
- 成果の可視化

## 6. 設定・カスタマイズ機能

### 6.1 学習設定
**設定項目**:
- セッション時間（15分/30分/45分）
- 学習難易度（初級/中級/上級）
- 専門分野の重み付け
- 音声設定（速度、ON/OFF）

### 6.2 UIカスタマイズ
**設定項目**:
- テーマ（ライト/ダーク）
- フォントサイズ
- 色設定（アクセシビリティ対応）
- レイアウト設定

### 6.3 プライバシー設定
**設定項目**:
- 学習データの保存期間
- 匿名化オプション
- データエクスポート
- アカウント削除

## 7. オフライン機能

### 7.1 PWA機能
**オフライン対応**:
- 過去の学習履歴閲覧
- 保存済みコンテンツの復習
- オフライン状態の通知
- ネットワーク復帰時の同期

### 7.2 データ同期
**同期処理**:
- 学習進捗の差分同期
- 設定の同期
- 競合解決
- エラー処理

## 8. 分析・レポート機能

### 8.1 学習分析
**分析項目**:
- 学習効率（時間あたりの理解度向上）
- 苦手分野の特定
- 最適な学習時間帯の特定
- 学習パターンの分析

### 8.2 レポート生成
**レポート種類**:
- 週次学習レポート
- 月次進捗レポート
- 年次スキルマップ
- 個人最適化レポート

## 9. エラーハンドリング・フォールバック

### 9.1 システムエラー対応
**エラー種類**:
- ネットワークエラー
- AI APIエラー
- データベースエラー
- 認証エラー

**フォールバック処理**:
- ローカルキャッシュからの復元
- 縮退運転モード
- エラーレポート送信
- ユーザーへの適切な案内

### 9.2 データ整合性
**整合性保証**:
- 学習データの冗長化
- 定期的なデータ検証
- 破損データの復旧
- バックアップからの復元

この機能仕様書により、Talk with AI の各機能の詳細な動作を定義し、開発チームが一貫した実装を行えるようにします。